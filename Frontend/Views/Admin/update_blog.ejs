</html>
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Update</title>


    <!-- Quill CSS -->
    <link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">

    <!-- Highlight.js for code syntax -->
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css" />

    <!-- KaTeX for Math -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" />

    <!-- Cropper.js for Image Cropping -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css">

    <!-- My Custom CSS -->

    <link rel="stylesheet" href="/Style/style.css">

    <style>
        /* Image alignment styles */
        .ql-editor img {
            display: inline-block;
            margin: 10px;
        }

        .ql-editor img.align-left {
            float: left;
            margin-right: 10px;
        }

        .ql-editor img.align-right {
            float: right;
            margin-left: 10px;
        }

        .ql-editor img.align-center {
            display: block;
            margin: 10px auto;
        }

        /* Cropper Modal */
        #cropper-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #fff;
            padding: 20px;
            z-index: 1000;
            border-radius: 10px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body>
    <div class="upload-container">
        <h1>Update Blog</h1>
        <form id="blogForm" action="/admin/<%=blog._id%>?_method=PUT" method="post" enctype="multipart/form-data">
            <div class="form-group">
                <label for="title"><span style="color: red; font-size: 14px;">* </span>Blog Title</label>
                <input type="text" id="title" name="title" placeholder="Enter blog title" value="<%= blog.title %>"
                    oninput="updateTitleCharCount()" required>
                <p id="charTitleCount" style="font-size: 14px; color: gray; margin-top: 4px;">0/250 characters</p>
            </div>

            <div class="form-group">
                <label for="description"><span style="color: red; font-size: 14px;">* </span>Blog Description</label>
                <input type="text" id="description" name="description" placeholder="Enter short description..."
                    value="<%= blog.description %>" maxlength="120" minlength="10"
                    oninput="updateDescriptionCharCount()" required>
                <p id="charDescriptionCount" style="font-size: 14px; color: gray; margin-top: 4px;">0/120 characters</p>
            </div>

            <div id="toolbar-wrapper">
                <div id="toolbar-container">
                    <span class="ql-formats">
                        <select class="ql-font"></select>
                        <select class="ql-size"></select>
                    </span>
                    <span class="ql-formats">
                        <button class="ql-bold"></button>
                        <button class="ql-italic"></button>
                        <button class="ql-underline"></button>
                        <button class="ql-strike"></button>
                    </span>
                    <span class="ql-formats">
                        <select class="ql-color"></select>
                        <select class="ql-background"></select>
                    </span>
                    <span class="ql-formats">
                        <button class="ql-script" value="sub"></button>
                        <button class="ql-script" value="super"></button>
                    </span>
                    <span class="ql-formats">
                        <button class="ql-header" value="1"></button>
                        <button class="ql-header" value="2"></button>
                        <button class="ql-blockquote"></button>
                        <button class="ql-code-block"></button>
                    </span>
                    <span class="ql-formats">
                        <button class="ql-list" value="ordered"></button>
                        <button class="ql-list" value="bullet"></button>
                        <button class="ql-indent" value="-1"></button>
                        <button class="ql-indent" value="+1"></button>
                    </span>
                    <span class="ql-formats">
                        <button class="ql-direction" value="rtl"></button>
                        <select class="ql-align"></select>
                    </span>
                    <span class="ql-formats">
                        <button class="ql-link"></button>
                        <button class="ql-image"></button>
                        <button class="ql-video"></button>
                        <button class="ql-formula"></button>
                    </span>
                    <span class="ql-formats">
                        <button class="ql-clean"></button>
                    </span>
                </div>
            </div>
            <div id="editor"></div>
            <input type="hidden" id="content" name="content" />
            <div class="form-group">
                <label for="author">Author Name</label>
                <input type="text" id="author" name="author" placeholder="Author name" value="<%= blog.author %>"
                    maxlength="40" minlength="3" oninput="updateAuthorCharCount()">
                <p id="charAuthorCount" style="font-size: 14px; color: gray; margin-top: 4px;">0/40</p>
            </div>

            <div class="form-group">
                <label for="category">Category</label>
                <select id="category" name="category" required>
                    <option value="<%= blog.category %>">
                        <%= blog.category %>
                    </option>
                    <option value="Programming">Programming</option>
                    <option value="Web-Developement">Web Developement</option>
                    <option value="Android-Development">Android Development</option>
                    <option value="ai-ml">AI and ML</option>
                    <option value="Software-Development">Software Development</option>
                    <option value="Technology">Technolgy</option>
                </select>
            </div>

            <div class="form-group">
                <label for="tags">Tags</label>
                <input type="text" id="tags" name="tags" placeholder="Comma-separated tags (e.g., JavaScript, Web)"
                    value="<%= blog.tags %>">
            </div>

            <div class="form-group">
                <p>Preview Image</p>
                <img src="<%= blog.image.url %>" alt="" style="height: 180px; width: 300px;">
            </div>

            <div class="form-group" style="font-family: Arial, sans-serif; font-size: 14px;">
                <label for="image-url" style="font-weight: bold; display: block; margin-bottom: 8px;">
                    Update Image (Optional)
                </label>
                <div style="margin-bottom: 12px; color: #555;">
                    <p style="margin: 4px 0;">
                        <strong>Recommended Size:</strong> 1066 x 613 pixels
                    </p>
                    <p style="margin: 4px 0;">
                        <strong>Acceptable Range:</strong> 1050–1080 x 600–620 pixels
                    </p>
                    <p style="margin: 4px 0;">
                        <strong>Supported Formats:</strong> PNG, JPG, JPEG
                    </p>
                    <p style="margin: 4px 0;">
                        <strong>File Size:</strong> 100 KB to 500 KB (Max: 1 MB)
                    </p>
                </div>
                <input type="file" id="image-url" name="image"
                    style="border: 1px solid #ccc; padding: 8px; width: 100%; border-radius: 4px;">
            </div>
            <button type="submit">Update Blog</button>
        </form>
    </div>
    <!-- Scripts -->
    <script src="/JavaScript/adminBlock.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/quill-image-resize-module@3.0.0/image-resize.min.js"></script>

    <script>
        // Initialize Quill Editor
        function initializeQuill() {
            if (typeof Quill === "undefined") {
                console.error("Quill is not loaded!");
                return;
            }

            // Register the ImageResize module
            if (typeof ImageResize !== "undefined") {
                Quill.register('modules/imageResize', ImageResize.default || ImageResize);
            } else {
                console.error("ImageResize module is not loaded!");
                return;
            }

            // Initialize Quill
            window.quill = new Quill('#editor', {
                modules: {
                    syntax: true,
                    toolbar: {
                        container: '#toolbar-container',
                        handlers: {
                            image: imageHandler, // Use the imageHandler for image uploads
                        }
                    },
                    imageResize: {
                        displaySize: true
                    }
                },
                placeholder: 'Write Your Blog Here',
                theme: 'snow',
            });

            // Set existing content in Quill editor
            const existingContent = `<%- blog.content %>`; // Get blog content from server-side rendering
            quill.root.innerHTML = existingContent;

            // Update the hidden input with the editor's content
            const contentInput = document.getElementById('content');
            quill.on('text-change', () => {
                contentInput.value = quill.root.innerHTML.trim();
            });
        }
        // Image Handler for Quill
        function imageHandler() {
            const input = document.createElement("input");
            input.setAttribute("type", "file");
            input.setAttribute("accept", "image/*");
            input.click();

            input.onchange = function () {
                const file = input.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = function (event) {
                    openCropper(event.target.result);
                };
            };
        }

        // Open Cropper for Image Cropping
        function openCropper(imageSrc) {
            const modal = document.createElement("div");
            modal.id = "cropper-modal";
            modal.innerHTML = `
        <div id="cropper-container">
            <img id="cropper-image" src="${imageSrc}" style="max-width:100%; height: auto;">
            <br>
            <button id="align-left">Left</button>
            <button id="align-center">Center</button>
            <button id="align-right">Right</button>
            <button id="crop-image-btn">Crop & Insert</button>
        </div>
    `;
            document.body.appendChild(modal);

            const image = document.getElementById("cropper-image");
            const cropper = new Cropper(image, {
                aspectRatio: 0,
                viewMode: 1,
            });

            let alignment = "align-left"; // Default alignment

            // Handle alignment button clicks
            document.getElementById("align-left").addEventListener("click", () => {
                alignment = "align-left";
            });

            document.getElementById("align-center").addEventListener("click", () => {
                alignment = "align-center";
            });

            document.getElementById("align-right").addEventListener("click", () => {
                alignment = "align-right";
            });

            document.getElementById("crop-image-btn").addEventListener("click", () => {
                if (!window.quill) {
                    console.error("Quill is not initialized yet!");
                    return;
                }

                const canvas = cropper.getCroppedCanvas();
                if (!canvas) {
                    console.error("Cropping failed!");
                    return;
                }

                const croppedImage = canvas.toDataURL("image/png");

                // Insert image with proper alignment
                const range = quill.getSelection(true);
                const imgTag = `<div class="${alignment}"><img src="${croppedImage}" /></div>`;
                quill.clipboard.dangerouslyPasteHTML(range.index, imgTag);

                // Cleanup
                cropper.destroy();
                document.body.removeChild(modal);
            });
        }
        // Initialize Quill after the DOM is loaded
        document.addEventListener("DOMContentLoaded", function () {
            initializeQuill();
        });
    </script>
</body>

</html>
<!-- 
<script>
    // Initialize Quill
    const quill = new Quill('#editor', {
        modules: {
            syntax: true,
            toolbar: '#toolbar-container',
        },
        placeholder: 'Write Your Blog Here',
        theme: 'snow',
    });

    // Get the hidden input and set Quill content from existing blog data
    const contentInput = document.getElementById('content');
    const existingContent = `<%- blog.content %>`; // Get blog content from server-side rendering

    // Set Quill editor content
    quill.root.innerHTML = existingContent;

    // Update hidden input whenever the editor content changes
    quill.on('text-change', () => {
        contentInput.value = quill.root.innerHTML;
    });

</script> -->